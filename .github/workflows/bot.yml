name: Audio Effect Bot Runner

on:
  workflow_dispatch:
    inputs:
      restart:
        description: 'Boty t√§zeden i≈ület'
        required: false
        default: 'true'

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Kody github-dan √ßek
      uses: actions/checkout@v3
      
    - name: Python gurnama
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Gerekli paketleri gurnama
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg libsndfile1
        pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Boty i≈ület
      run: |
        echo "ü§ñ Audio Effect Bot ba≈ülan√Ωar..."
        echo "Bot Token: ${{ secrets.BOT_TOKEN }}"
        
        # Boty 5 sekunt so≈à i≈ület
        sleep 5
        
        # Boty 1 sagat dowamly i≈ület
        timeout 3600 python audio_effect_bot.py &
        BOT_PID=$!
        
        # Boty≈à i≈ül√Ω√§ndigine g√∂z √Ωetirmek
        sleep 10
        
        if ps -p $BOT_PID > /dev/null; then
          echo "‚úÖ Bot i≈üle√Ω√§r! PID: $BOT_PID"
          # Bot i≈ül√§n wagty g√∂zlemek
          wait $BOT_PID
          echo "üîÑ Bot tamamlandy"
        else
          echo "‚ùå Bot i≈ülemedi!"
          exit 1
        fi
      
    - name: Bot √ßyk√Ωan√ßa g√∂z √Ωetir
      if: always()
      run: |
        echo "üìä Bot loglary:"
        ps aux | grep python
        echo "‚úÖ Workflow tamamlandy"
